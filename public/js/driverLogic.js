let bid = "bus";
let socket = null;
let intervalFunction = null;
let i = 0;
{
  var obj = [[ 72.82789707183838, 19.21533098624653 ], [ 72.82875537872313, 19.215371510700702 ], [ 72.82944202423096, 19.21533098624653 ], [ 72.83012866973877, 19.21533098624653 ], [ 72.8309440612793, 19.21533098624653 ], [ 72.83154487609863, 19.215290461782384 ], [ 72.83201694488524, 19.215290461782384 ], [ 72.83253192901611, 19.215290461782384 ], [ 72.83317565917969, 19.215290461782384 ], [ 72.83369064331055, 19.21516888833001 ], [ 72.83437728881836, 19.21516888833001 ], [ 72.83502101898193, 19.21524993730825 ], [ 72.83579349517822, 19.21524993730825 ], [ 72.83648014068604, 19.21524993730825 ], [ 72.83712387084961, 19.21524993730825 ], [ 72.83763885498047, 19.2151283638259 ], [ 72.83806800842285, 19.215047314787725 ], [ 72.83862590789795, 19.21480416743342 ], [ 72.83926963806151, 19.214561019719497 ], [ 72.83982753753662, 19.214317871645942 ], [ 72.84025669097899, 19.21407472321277 ], [ 72.84068584442139, 19.213750524742487 ], [ 72.84124374389647, 19.21342632563287 ], [ 72.84167289733887, 19.21318317588114 ], [ 72.84218788146973, 19.21298055081331 ], [ 72.84257411956787, 19.21285897565276 ], [ 72.84321784973143, 19.21277792549578 ], [ 72.8439474105835, 19.2126563501854 ], [ 72.8445053100586, 19.2125347747851 ], [ 72.84502029418945, 19.212413199294918 ], [ 72.84583568572997, 19.212210573278174 ], [ 72.84643650054932, 19.21212952280156 ], [ 72.84712314605713, 19.212170048044854 ], [ 72.84768104553223, 19.212372674111545 ], [ 72.84819602966309, 19.212413199294918 ], [ 72.84883975982666, 19.212575299928524 ], [ 72.84926891326904, 19.21281845057927 ], [ 72.84961223602295, 19.212899500716276 ], [ 72.85017013549805, 19.213061600870407 ], [ 72.8506851196289, 19.21338580069922 ], [ 72.85102844238281, 19.21387209924376 ], [ 72.85107135772705, 19.214398921043752 ], [ 72.85102844238281, 19.214925741155533 ], [ 72.85162925720215, 19.2147231182354 ], [ 72.85205841064453, 19.214479970401612 ], [ 72.85238027572632, 19.214459708065895 ], [ 72.85261631011963, 19.214398921043752 ], [ 72.85272359848022, 19.21417603510364 ], [ 72.85274505615233, 19.21391262405755 ], [ 72.85304546356201, 19.21387209924376 ], [ 72.8533673286438, 19.2138923616519 ], [ 72.85360336303711, 19.21387209924376 ], [ 72.85377502441406, 19.21383157441999 ], [ 72.85403251647949, 19.21373026231686 ], [ 72.85420417785645, 19.213649212589395 ], [ 72.8543972969055, 19.213568162821996 ], [ 72.85461187362671, 19.21350737547022 ], [ 72.85486936569214, 19.21334527575559 ], [ 72.85504102706908, 19.213243963352774 ], [ 72.85525560379028, 19.21320343837418 ], [ 72.85542726516724, 19.213122388387013 ], [ 72.85564184188843, 19.213061600870407 ], [ 72.8558349609375, 19.212960288292805 ], [ 72.85609245300293, 19.21287923818577 ], [ 72.8563928604126, 19.21279818803878 ], [ 72.85662889480591, 19.21261582506195 ], [ 72.8569507598877, 19.2125347747851 ], [ 72.85720825195312, 19.212595562496485 ], [ 72.85748720169067, 19.21261582506195 ], [ 72.85776615142822, 19.2126563501854 ], [ 72.85802364349365, 19.21269687529885 ], [ 72.8583025932312, 19.212717137851822 ], [ 72.85858154296875, 19.212717137851822 ], [ 72.85888195037842, 19.21277792549578 ], [ 72.85916090011597, 19.21275766295029 ], [ 72.85939693450928, 19.212636087624922 ], [ 72.85954713821411, 19.212555037358058 ], [ 72.8597617149353, 19.212332148918186 ], [ 72.85993337631226, 19.212251098501493 ], [ 72.86019086837769, 19.212170048044854 ], [ 72.86040544509888, 19.21239293670448 ], [ 72.86051273345947, 19.21269687529885 ], [ 72.86057710647583, 19.212940025769793 ], [ 72.86085605621338, 19.213061600870407 ], [ 72.86124229431152, 19.213102125883978 ], [ 72.86154270172119, 19.213102125883978 ], [ 72.86186456680298, 19.213122388387013 ], [ 72.862229347229, 19.213122388387013 ], [ 72.86242246627808, 19.213122388387013 ], [ 72.86287307739258, 19.213122388387013 ], [ 72.86317348480225, 19.213142650887548 ], [ 72.8634524345398, 19.21318317588114 ], [ 72.86373138427734, 19.213122388387013 ], [ 72.86403179168701, 19.21320343837418 ], [ 72.86433219909668, 19.213243963352774 ], [ 72.8646969795227, 19.213325013280016 ], [ 72.86497592926025, 19.21338580069922 ], [ 72.86527633666992, 19.213466850556532 ], [ 72.86561965942383, 19.213547900373893 ], [ 72.86600589752197, 19.21368973745812 ], [ 72.866370677948, 19.21373026231686 ]]
}
function sendServer() {

    const b_id = document.getElementById("BusNo").value;
    const sid = document.getElementById("ShiftNo").value;
    $.post("/UpdateConductorRouteInfo", {
        BusNo: b_id,
        Shift: sid
    }, function(data) {

        document.getElementById("RouteId").innerHTML = "Your Route ID is " + data;
        bid = data;
        socket = io('http://localhost:3600');
    });
}

function sendSMS() {
    const sid = document.getElementById("Sid").value;
    $.post("/FindParentSendNotification", {
        RegNo: sid
    }, function(data) {
        document.getElementById("Sid").value="";
        console.log("Parent to be sent success SMS " + data);
        $.post("/sendsms", {message : "Your child has boarded", tosend:  data}, (successMsg)=>{
          console.log(successMsg + "Message sent!");
        })
    });
}
document.getElementById("journey").addEventListener( "click", ()=> {
  if(bid=="bus"){
    alert("Enter Credentials!");
  }
  else{
    socket.emit('new-user', bid);
    let journeyElement = document.getElementById("journey");
    if(!!journeyElement){
      $("#journey").empty();
      $("#journey").append('<button id = "endJourney" onclick = "endJourney()" >Journey started. End Journey? </button>');
      document.getElementById("journey").id= "endJourney";

    let lat, curLat;
    let lang, curLang;
    let dif = 1;

    navigator.geolocation.getCurrentPosition((pos) => {
        // lat = curLat = pos.coords.latitude;
        // lang = curLang = pos.coords.longitude;
        lat = curLat = obj[0][1]
        lang = curLang = obj[0][0]
    });

    intervalFunction = setInterval(timer, 500);

    function timer(){

          curLat=obj[i++][1];
          curLang=obj[i][0];

          if(i == obj.length-1){
            clearInterval(intervalFunction);
          }

      room = bid;

      let position = {
          lat: curLat,
          lang: curLang,
          room: bid
      }
      socket.emit('getloc', position);

      $("#Presentloc").html(`${curLat} , ${curLang} , ${room}`);
  }

  }
}
});

function endJourney() {
  document.getElementById("endJourney").innerHTML = "<button>Journey Ended</button>";
  socket.emit('dis-user', bid);
  clearInterval(intervalFunction);
  location.reload();
}
