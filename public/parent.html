<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

    <script src="http://localhost:3600/socket.io/socket.io.js"></script>
</head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<body>
    <div class="container">
        <br>
        <div class="form-style-6">
            <h1 class="display-4">Receiving Location at parent</h1>
            <br>
            <input type="text" placeholder="Enter Mobile Number" id="PhNo">
            <p id="DropBox"></p>
            <button onclick="getRouteId()" id="RouteButton">What is my Route ID</button>
            <br><br>
            <input type="text" id="bid" name="" placeholder="Enter Route ID if you know it">
            <br><br>
            <button id="sendloc" onclick="start()">Start receiving location</button>

        </div>
        <div id="Presentloc">

        </div>
    </div>

<script>
var bid = "bus";
var socket = io('http://localhost:3600');

function start() {
    socket.emit('new-user', bid);
    socket.on('loc', addMessages);
}

function addMessages(message) {
    $("#Presentloc").html('')
    $("#Presentloc").append(`<p> ${message.lat} , ${message.lang} </p>`);
}

function getRouteId() {
    let phNo = document.getElementById("PhNo").value;
    $.post("/UpdateParentRouteInfo", {
        PhNo: phNo
    }, (data) => {
        if (data.length == 1) {
            document.getElementById("bid").value = "Your Route ID is " + data[0].route_id;
            bid = data[0].route_id;
        } else if (data.length > 1) {

            var RouteButton = document.getElementById("RouteButton");
            RouteButton.parentNode.removeChild(RouteButton);

            var html = `<select  id = "DropDown">` +
                `<option selected hidden style='display:none'>Select Childname</option>`;

            data.forEach(element => {
                html += `<option>${element.name}</option>`;
            });

            html = html + `</select><button id="Childname">Submit</button>`;
            console.log(html);
            $("#DropBox").append(html);

            $("#Childname").click(function() {
                let Childname = document.getElementById("DropDown").value;
                console.log("User has Selected the childname " + Childname);
                data.forEach(element => {
                    if (element.name == Childname) {
                        document.getElementById("bid").value = "Your Route ID is " + element.route_id;
                        bid = element.route_id;
                    }
                });
            });
        } else {
            alert("Enter a registered Phone Number");
            document.getElementById("PhNo").value = "";
        }
    })
}
</script>
</body>
</html>
